<style>
  /* Lightbox Styles */
  #lightbox {
    position: fixed;
    z-index: 1000;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  #lightbox.active {
    opacity: 1;
    visibility: visible;
  }

  #lightbox img {
    max-width: 90%;
    max-height: 90%;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    border-radius: 4px;
    cursor: grab;
    transform-origin: center center;
    transition: transform 0.1s ease-out;
  }

  #lightbox img:active {
    cursor: grabbing;
  }

  #lightbox-close {
    position: absolute;
    top: 20px;
    right: 30px;
    font-size: 40px;
    color: white;
    cursor: pointer;
    z-index: 1001;
    line-height: 1;
  }

  .lightbox-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 50px;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    z-index: 1001;
    padding: 20px;
    user-select: none;
    transition: color 0.2s;
  }

  .lightbox-arrow:hover {
    color: white;
  }

  #lightbox-prev {
    left: 10px;
  }

  #lightbox-next {
    right: 10px;
  }

  #lightbox-carousel {

    position: absolute;

    bottom: 0;

    left: 0;

    width: 100%;

    height: 220px;

    display: flex;

    justify-content: center;

    gap: 15px;

    padding: 10px 0 20px 0;

    overflow-x: auto;

    z-index: 1002;

    box-sizing: border-box;

    pointer-events: none;

    transition: opacity 0.3s ease;

    scrollbar-width: thin;
    scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
  }



  .lightbox-thumb {

    display: block;

    height: 150px;

    width: auto;

    cursor: pointer;

    opacity: 0.5;

    border: 4px solid transparent;

    border-radius: 4px;

    transition: all 0.2s;

    flex-shrink: 0;

    box-sizing: border-box;

    pointer-events: auto;
    /* Re-enable clicks on thumbs */

    object-fit: cover;

  }



  .lightbox-thumb:hover,
  .lightbox-thumb.active {

    opacity: 1;

    border-color: var(--orange);

  }



  #lightbox img {

    max-width: 90%;

    max-height: 75%;

    margin-bottom: 220px;
    /* Make space for carousel */

    box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);

    border-radius: 4px;

    cursor: grab;

    transform-origin: center center;

    transition: transform 0.1s ease-out;

  }
</style>



<div id="lightbox">

  <span id="lightbox-close">&times;</span>

  <span id="lightbox-prev" class="lightbox-arrow">&lt;</span>

  <span id="lightbox-next" class="lightbox-arrow">&gt;</span>

  <img id="lightbox-img" src="" alt="Lightbox Image">

  <div id="lightbox-carousel"></div>

</div>



<script>

  const lightbox = document.getElementById("lightbox");

  const lightboxImg = document.getElementById("lightbox-img");

  const lightboxClose = document.getElementById("lightbox-close");

  const lightboxPrev = document.getElementById("lightbox-prev");

  const lightboxNext = document.getElementById("lightbox-next");

  const lightboxCarousel = document.getElementById("lightbox-carousel");



  let scale = 1;

  let translateX = 0;

  let translateY = 0;

  let isDragging = false;

  let startX = 0;

  let startY = 0;



  let galleryImages = [];

  let currentIndex = 0;



  function updateTransform() {



    lightboxImg.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;







    // Hide carousel when zoomed in



    if (scale > 1.01) {



      lightboxCarousel.style.opacity = '0';



    } else {



      lightboxCarousel.style.opacity = '1';



    }



  }



  function closeLightbox() {

    lightbox.classList.remove('active');

    document.body.style.overflow = '';

    scale = 1;

    translateX = 0;

    translateY = 0;

    updateTransform();

    lightboxCarousel.style.opacity = '1'; // Ensure visible next open

  }



  function updateCarouselActive() {

    const thumbs = lightboxCarousel.querySelectorAll('.lightbox-thumb');

    thumbs.forEach((thumb, i) => {

      if (i === currentIndex) {

        thumb.classList.add('active');

        thumb.scrollIntoView({behavior: 'smooth', block: 'nearest', inline: 'center'});

      } else {

        thumb.classList.remove('active');

      }

    });

  }



  function updateImage(index) {

    if (index < 0) index = galleryImages.length - 1;

    if (index >= galleryImages.length) index = 0;



    currentIndex = index;

    const img = galleryImages[currentIndex];

    const fullUrl = img.getAttribute('data-full-url') || img.src;



    lightboxImg.src = fullUrl;

    lightboxImg.alt = img.alt;



    // Reset zoom/pan

    scale = 1;

    translateX = 0;

    translateY = 0;

    updateTransform();



    // Ensure carousel is visible when switching images

    lightboxCarousel.style.opacity = '1';



    updateCarouselActive();

  }

  function buildCarousel() {
    lightboxCarousel.innerHTML = '';
    galleryImages.forEach((img, index) => {
      const thumb = document.createElement('img');
      thumb.src = img.src; // Use thumbnail source
      thumb.className = 'lightbox-thumb';
      thumb.alt = img.alt;
      thumb.onclick = (e) => {
        e.stopPropagation();
        updateImage(index);
      };
      lightboxCarousel.appendChild(thumb);
    });
  }

  // Lightbox Open
  document.addEventListener('click', function (e) {
    if (e.target.classList.contains('lightbox-trigger')) {
      // Refresh the list of images on page
      galleryImages = Array.from(document.querySelectorAll('.lightbox-trigger'));
      const index = galleryImages.indexOf(e.target);

      if (index !== -1) {
        buildCarousel();
        updateImage(index);
        lightbox.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
    }
  });
  // Navigation
  lightboxPrev.addEventListener('click', (e) => {
    e.stopPropagation(); // Prevent closing lightbox
    updateImage(currentIndex - 1);
  });

  lightboxNext.addEventListener('click', (e) => {
    e.stopPropagation(); // Prevent closing lightbox
    updateImage(currentIndex + 1);
  });

  // Close Actions
  lightboxClose.addEventListener('click', closeLightbox);

  lightbox.addEventListener('click', (e) => {
    if (e.target === lightbox) {
      closeLightbox();
    }
  });

  document.addEventListener('keydown', (e) => {
    if (!lightbox.classList.contains('active')) return;

    if (e.key === 'Escape') {
      closeLightbox();
    } else if (e.key === 'ArrowLeft') {
      updateImage(currentIndex - 1);
    } else if (e.key === 'ArrowRight') {
      updateImage(currentIndex + 1);
    }
  });

  // Zoom Logic
  lightbox.addEventListener('wheel', (e) => {
    if (!lightbox.classList.contains('active')) return;
    e.preventDefault();

    const zoomIntensity = 0.1;
    const direction = e.deltaY < 0 ? 1 : -1;
    const factor = direction > 0 ? (1 + zoomIntensity) : (1 / (1 + zoomIntensity));

    const rect = lightboxImg.getBoundingClientRect();

    const newScale = Math.min(Math.max(0.5, scale * factor), 5);

    if (newScale !== scale) {
      const dx = e.clientX - (rect.left + rect.width / 2);
      const dy = e.clientY - (rect.top + rect.height / 2);

      translateX -= dx * (factor - 1);
      translateY -= dy * (factor - 1);
      scale = newScale;
      updateTransform();
    }
  });

  // Drag Logic
  lightboxImg.addEventListener('mousedown', (e) => {
    e.preventDefault();
    isDragging = true;
    startX = e.clientX - translateX;
    startY = e.clientY - translateY;
    lightboxImg.style.transition = 'none'; // Disable transition for direct dragging
  });

  window.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    e.preventDefault();
    translateX = e.clientX - startX;
    translateY = e.clientY - startY;
    updateTransform();
  });

  window.addEventListener('mouseup', () => {
    if (isDragging) {
      isDragging = false;
      lightboxImg.style.transition = 'transform 0.1s ease-out'; // Re-enable transition
    }
  });
</script>
